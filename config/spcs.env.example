# Copy to config/spcs.env and edit. This file is sourced by ./cli/spcs.sh (bash).

# ---- Snowflake CLI connection selection ----
# Name from your Snowflake CLI config.toml [connections.<name>]
SNOW_CONNECTION=spcs-dev

# Optional: use repo-local Snowflake CLI config at ./.snowflake/config.toml (recommended)
# If you keep config there, you usually don't need to set SNOWFLAKE_HOME.

# ---- Naming / locations (Snowflake objects) ----
APP_DB=APP_DB
APP_SCHEMA=APP_SCHEMA

# Stages
CONFIG_STAGE=@${APP_DB}.${APP_SCHEMA}.app_config_superset
ARTIFACT_STAGE=@${APP_DB}.${APP_SCHEMA}.app_artifacts

# Secrets
SECRET_SUPERSET_DB_URI=${APP_DB}.${APP_SCHEMA}.superset_db_uri
SECRET_SUPERSET_SECRET_KEY=${APP_DB}.${APP_SCHEMA}.superset_secret_key
SECRET_SUPERSET_FERNET_KEY=${APP_DB}.${APP_SCHEMA}.superset_fernet_key
SECRET_SUPERSET_ADMINS=${APP_DB}.${APP_SCHEMA}.superset_admins

# Values used by `./cli/spcs.sh create-secrets` to populate the above Snowflake secrets.
# - If *_VALUE is not set, the script generates safe defaults for keys, and tries to infer admins from the Snowflake connection user.
# - For managed profile, this should be your externally reachable Postgres (or Snowflake-managed Postgres) URI.
# - For allinone profile, you can omit SUPERSET_DB_URI_VALUE (it defaults to postgres://superset:superset@postgres:5432/superset).
#
# SUPERSET_DB_URI_VALUE=postgresql+psycopg2://user:pass@host:5432/dbname
# SUPERSET_SECRET_KEY_VALUE=change-me
# SUPERSET_FERNET_KEY_VALUE=change-me
# SUPERSET_ADMINS_VALUE=my_username,other_username

# Note (allinone): the service spec uses these *_VALUE env vars directly (via envsubst)
# to set `SUPERSET_SECRET_KEY` / `SUPERSET_FERNET_KEY` / `SUPERSET_BOOTSTRAP_ADMINS`.

# Image repository (Snowflake Image Repository) - all images referenced by SPCS specs should live here.
IMAGE_REPO_NAME=superset_repo
IMAGE_REPO=${APP_DB}.${APP_SCHEMA}.${IMAGE_REPO_NAME}

# Image name/tag (within the image repository)
IMAGE_NAME=superset-spcs
IMAGE_TAG=latest

# Fully-qualified image reference used inside SPCS specs.
# Example (shape): /APP_DB/APP_SCHEMA/superset_repo/superset-spcs:latest
SPCS_IMAGE=/${APP_DB}/${APP_SCHEMA}/${IMAGE_REPO_NAME}/${IMAGE_NAME}:${IMAGE_TAG}
SPCS_REDIS_IMAGE=/${APP_DB}/${APP_SCHEMA}/${IMAGE_REPO_NAME}/redis:7-alpine
SPCS_POSTGRES_IMAGE=/${APP_DB}/${APP_SCHEMA}/${IMAGE_REPO_NAME}/postgres:16-alpine

# ---- SPCS deployment targets ----
COMPUTE_POOL=YOUR_COMPUTE_POOL
SERVICE_NAME=superset

# Optional: auto-create compute pool (requires CREATE COMPUTE POOL privilege)
# AUTO_CREATE_COMPUTE_POOL=0
# COMPUTE_POOL_INSTANCE_FAMILY=CPU_X64_XS
# COMPUTE_POOL_MIN_NODES=1
# COMPUTE_POOL_MAX_NODES=1

# Network/EAI (when Superset needs egress to managed Postgres host)
PG_EAI_NAME=pg_meta_eai

# ---- Optional toggles ----
# Set to 1 to run bootstrap job before service apply.
# - `managed`: recommended (job runs migrations/admin creation against external DB)
# - `allinone`: not recommended (jobs must exit; Postgres/Redis are long-running). Use RUN_BOOTSTRAP=0.
RUN_BOOTSTRAP=1
BOOTSTRAP_JOB_NAME=superset_bootstrap

# Optional: override which bootstrap job spec to run (auto-picked by profile if unset).
# BOOTSTRAP_SPEC=

# Optional: generate a unique job service name on every run (avoids "already exists").
# JOB_NAME_UNIQUE=0

# Choose which service spec to apply by default: managed or allinone
SPCS_PROFILE=managed

# Set to 1 to create DB/SCHEMA/stages/image repository if missing.
AUTO_BOOTSTRAP_SNOWFLAKE=1

# Set to 1 to login to the Snowflake image registry and push images for this repo.
PUSH_IMAGE=1
